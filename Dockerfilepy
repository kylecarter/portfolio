FROM python:3.7.3-alpine3.10

# Define arguments
ARG PIPENV_VENV_IN_PROJECT
ARG SECRET_KEY
ARG ALLOWED_HOSTS

ARG DJANGO_HOST
ARG DJANGO_PORT
ARG DEBUG
ARG JS_DEBUG
ARG LOCAL_DEV
ARG TEMPLATE_DEBUG

ARG DB_NAME
ARG DB_USER
ARG DB_HOST
ARG DB_PORT

# Make the arguments environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

ENV SECRET_KEY $SECRET_KEY
ENV ALLOWED_HOSTS $ALLOWED_HOSTS
ENV PIPENV_VENV_IN_PROJECT $PIPENV_VENV_IN_PROJECT

ENV DJANGO_HOST $DJANGO_HOST
ENV DJANGO_PORT $DJANGO_PORT
ENV DEBUG $DEBUG
ENV JS_DEBUG $JS_DEBUG
ENV LOCAL_DEV $LOCAL_DEV
ENV TEMPLATE_DEBUG $TEMPLATE_DEBUG
ENV PRODUCTION $PRODUCTION

ENV DB_NAME $DB_NAME
ENV DB_USER $DB_USER
ENV DB_HOST $DB_HOST
ENV DB_PORT $DB_PORT

# Create working directories
RUN mkdir -p /usr/src/app
WORKDIR /usr/src/app

# Copy project
COPY . /usr/src/app

# Make sure yarn and pipenv are available
RUN pip install pipenv

# Now we install.
RUN pipenv install --system

# Expose a port
EXPOSE 8000
